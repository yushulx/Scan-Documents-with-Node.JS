<html>

<head>
	<title>Scan Documents with Node JS</title>
	<script src="https://unpkg.com/dwt/dist/dynamsoft.webtwain.min.js"> </script>
	<style>
		h1 {
			font-size: 2em;
			font-weight: bold;
			color: #777777;
			text-align: center
		}

		table {
			margin: auto;
		}
	</style>
</head>

<body>
	<h1>
		Scan Documents with Node JS
	</h1>
	<table>
		<tr>
			<td>
				<div id="dwtcontrolContainer"></div>
			</td>
		</tr>
		<tr>
			<td>
				<input type="button" value="Load Image" onclick="LoadImages();" />
				<input type="button" value="Scan Image" onclick="AcquireImage();" />
				<input id="btnUpload" type="button" value="Upload Image" onclick="btnUpload_onclick()">
			</td>
		</tr>
	</table>

	<!--Custom script goes here-->
	<script type="text/javascript">
		var DWObject;

		window.onload = function () {
			Dynamsoft.DWT.AutoLoad = false;
			Dynamsoft.DWT.Containers = [{ ContainerId: 'dwtcontrolContainer', Width: '400px', Height: '500px' }];
			Dynamsoft.DWT.RegisterEvent('OnWebTwainReady', Dynamsoft_OnReady);
			/**
			 * In order to use the full version, do the following
			 * 1. Replace A-Valid-Product-Key with a full version key
			 * 2. Change Dynamsoft.DWT.ResourcesPath to point to the full version 
			 *    resource files that you obtain after purchasing a key
			 */
			//Dynamsoft.DWT.ProductKey = "A-Valid-Product-Key";
			//Dynamsoft.DWT.ResourcesPath = "https://tst.dynamsoft.com/libs/dwt/17.0";
			Dynamsoft.DWT.ProductKey = 't00901wAAAFGokK55GCTHFf8RWZ8bKjNRD1O+Gf0xA6MUdkmYI6zSueLnBjy55bNxl/YW1HkZykS/h0xYHBuFFwIDbexR567425Cx3hnuwAewN5DyXtRd/ATLnyy+';
			Dynamsoft.DWT.ResourcesPath = 'https://unpkg.com/dwt/dist/';

			Dynamsoft.DWT.Load();
		};

		function Dynamsoft_OnReady() {
			DWObject = Dynamsoft.DWT.GetWebTwain('dwtcontrolContainer');
		}

		function AcquireImage() {
			if (DWObject) {
				DWObject.SelectSource(function () {
					var OnAcquireImageSuccess, OnAcquireImageFailure;
					OnAcquireImageSuccess = OnAcquireImageFailure = function () {
						DWObject.CloseSource();
					};
					DWObject.OpenSource();
					DWObject.IfDisableSourceAfterAcquire = true;
					DWObject.AcquireImage(OnAcquireImageSuccess, OnAcquireImageFailure);
				}, function () {
					console.log('SelectSource failed!');
				});
			}
		}

		function LoadImages() {
			if (DWObject) {
				DWObject.LoadImageEx('', 5,
					function () {
					},
					function (errorCode, errorString) {
						alert('Load Image:' + errorString);
					}
				);
			}
		}

		function btnUpload_onclick() {
			var strHTTPServer = location.hostname;
			DWObject.IfSSL = Dynamsoft.Lib.detect.ssl;
			var _strPort = location.port == "" ? 80 : location.port;
			if (Dynamsoft.Lib.detect.ssl == true)
				_strPort = location.port == "" ? 443 : location.port;
			DWObject.HTTPPort = _strPort;
			var CurrentPathName = unescape(location.pathname); // get current PathName in plain ASCII
			var CurrentPath = CurrentPathName.substring(0, CurrentPathName.lastIndexOf("/") + 1);
			var strActionPage = CurrentPath + "upload";
			var sFun = function () {
				console.log('successfully uploaded a file');
			}, fFun = function () {
				alert('failed to upload!');
			};
			var Digital = new Date();
			var uploadfilename = Digital.getMilliseconds();
			DWObject.HTTPUploadThroughPost(
				strHTTPServer,
				DWObject.CurrentImageIndexInBuffer,
				strActionPage,
				uploadfilename + ".jpg",
				sFun, fFun
			);
		}
	</script>
</body>

</html>